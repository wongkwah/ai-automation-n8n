{
  "name": "ğŸ”¥ çœåŠ›å·¥å…·ï¼OpenAI æœ€æ–°åœ–ç‰‡æ¨¡å‹ GPT-image-1 ç™»å ´ï¼å¦‚ä½•æ‰“é€ é›»å•†å•†å“åœ–ç‰‡ï¼Œå»ºç«‹éˆæ„Ÿä¾†æº AI Agent",
  "nodes": [
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.body.events[0].source.userId || $json.sessionId }} ",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        60,
        760
      ],
      "id": "3f05a0f2-09af-4831-95c3-3f4b707b93aa",
      "name": "Window Buffer Memory"
    },
    {
      "parameters": {
        "description": "=ä½ æ˜¯ã€Œå•†æ¥­è³‡æ–™åˆ†æå¸«ã€ï¼Œè² è²¬å°‡ä½¿ç”¨è€…æä¾›çš„å•†å“è³‡è¨Šé€²è¡Œæ•´ç†ã€åˆ†æèˆ‡å„ªåŒ–ï¼Œç”Ÿæˆé©åˆå¤–éƒ¨APIï¼ˆå¦‚OpenAI Image Generationï¼‰ä½¿ç”¨çš„é«˜å“è³ªè‹±æ–‡æè¿°ã€‚\n\nä½ çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š\n\n1. ä¾åºç¢ºèªä»¥ä¸‹ä¸‰å€‹æ ¸å¿ƒè³‡è¨Šæ˜¯å¦å®Œæ•´ï¼š\n   - å•†å“ç¨®é¡ï¼ˆé¡è‰²ã€æè³ªã€é¢¨æ ¼ï¼‰\n   - æ¨¡ç‰¹å…’ç‰¹å¾µï¼ˆæ€§åˆ¥ã€å¹´é½¡æ„Ÿã€é¢¨æ ¼ã€è¡¨æƒ…ï¼‰\n   - èƒŒæ™¯ç’°å¢ƒï¼ˆå ´æ™¯æ•˜è¿°ï¼‰\n   - è³‡è¨Šå¦‚æœæ²’æœ‰å®Œæ•´æ”¶é›†ï¼Œè«‹å‘ä½¿ç”¨è€…è¦æ±‚æ›´å¤šè³‡è¨Š\n\n2. è‹¥è³‡è¨Šæœ‰ç¼ºæ¼ï¼Œè‡ªè¡Œåˆç†è£œé½Šï¼ˆæ¨æ¸¬å¸¸è¦‹åˆç†é è¨­ï¼‰ï¼Œä½†åœ¨å¿…è¦æ™‚ä¿æŒæ¨¡ç³Šä»¥é¿å…éŒ¯èª¤\n\n3. å°‡ä»¥ä¸Šè³‡è¨Šæ•´åˆæˆï¼š\n   - ä¸€æ®µæµæš¢è‡ªç„¶çš„è‹±æ–‡Prompt\n   - è‡ªå‹•åŠ å…¥æå‡å“è³ªçš„æè¿°ï¼ˆå¦‚ \"high-quality\", \"photo studio lighting\", \"professional photography style\"ï¼‰\n\n4. ç¢ºä¿è¼¸å‡ºçš„Promptèªæ°£è‡ªç„¶ã€æœ‰å¸å¼•åŠ›ï¼Œé©åˆå•†å“å±•ç¤º\n\nç¦æ­¢äº‹é …ï¼š\n- ä¸å‘¼å«å¤–éƒ¨API\n- ä¸åšåœ–ç‰‡ç”Ÿæˆ\n- å°ˆæ³¨æ–¼å•†æ¥­é‚è¼¯æ¨æ¼”èˆ‡é«˜è³ªPromptæ’°å¯«\n\nï¼ˆç¯„ä¾‹ï¼šå°‡ã€Œç™½è‰²Tæ¤ã€å¹´è¼•å¥³æ€§ã€å’–å•¡é¤¨èƒŒæ™¯ã€æ•´ç†æˆå®Œæ•´è‹±æ–‡Promptï¼‰\n"
      },
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1,
      "position": [
        300,
        760
      ],
      "id": "1f0256de-457a-4bee-9241-a65aed78d8e4",
      "name": "Think"
    },
    {
      "parameters": {
        "content": "## Thinking\n\n",
        "height": 220,
        "width": 230,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        220,
        680
      ],
      "id": "69c86731-d1f6-4d8f-bcf6-ddf0b5facda5",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -160,
        760
      ],
      "id": "3b80e765-a48d-45c4-a6d0-b9c4cf8a4ae8",
      "name": "OpenAI 4.1",
      "credentials": {
        "openAiApi": {
          "id": "vo1Kz0pllXw8z5Cv",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "content": "## è¨˜æ†¶\n\n",
        "height": 220,
        "width": 210,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        680
      ],
      "id": "80bf7ceb-4613-4ba4-af2b-b8469c986834",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"prompt\": \"California\",\n\t\"image_numbers\": 1\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        540,
        760
      ],
      "id": "21585276-7a4f-45e7-a992-19c8ad8b690c",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"replyToken\": \"{{ $('Webhook from Line Message').item.json.body.events[0].replyToken }}\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"Model-{{ $('Model').item.json.model }}-ç”Ÿæˆåœ–ç‰‡ä¸‹è¼‰ç¶²å€ï¼š{{ $json.webContentLink }}\"\n    },\n    {\n      \"type\": \"image\",\n      \"originalContentUrl\": \"{{ $json.thumbnailLink }}\",\n      \"previewImageUrl\": \"{{ $json.thumbnailLink }}\"\n    }\n  ]\n}",
        "options": {}
      },
      "id": "4089b80a-ba28-4b15-a9ee-6476a29443d3",
      "name": "Line : Reply Image",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1420,
        300
      ],
      "typeVersion": 4.2,
      "credentials": {
        "httpHeaderAuth": {
          "id": "v799msNWDyFak0kO",
          "name": "Header Auth - Line Alex"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput || $('Webhook from Line Message').item.json.body.events[0].message.text }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=ä½ æ˜¯ä¸€å€‹æ¥­å‹™åˆ†æå¸«ï¼Œç”¢ç”Ÿé›»å•†çš„åœ–ç‰‡èˆ‡å•†å“æè¿°ï¼Œå¹«åŠ©éŠ·å”®\nè«‹æ ¹æ“šç”¨æˆ¶éœ€æ±‚ç”¢ç”Ÿ open ai çš„ gpt-image-1 api çš„ prompt\n\n## ä»»å‹™\n1. æ¥æ”¶å¾å…§éƒ¨ Think Tool è™•ç†å®Œçš„æ­£å¼æç¤ºï¼ˆPromptï¼‰\n2. æ ¹æ“šæ”¶åˆ°çš„Promptï¼Œèª¿ç”¨\"HTTP Request åœ–ç‰‡ç”Ÿæˆå·¥å…·\" APIä¾†ç”Ÿæˆåœ–ç‰‡\n3. æˆåŠŸå¾Œå°‡ç”Ÿæˆçš„ base64 stringï¼Œå¾€å¾Œè¼¸å‡ºåˆ°æˆåŠŸæµç¨‹æ–¹ä¾¿å¾ŒçºŒå­˜æˆåœ–ç‰‡\n\nè¨˜ä½ï¼š  \n- ä¸è‡ªè¡Œæ›´æ”¹Prompt  \n- ä¸é€²è¡Œå•†æ¥­é‚è¼¯æ¨è«–  \n- å°ˆæ³¨åŸ·è¡Œèˆ‡å¤–éƒ¨æœå‹™äº¤äº’\n\nè¼¸å‡ºjson æ ¼å¼\n{\n\t\"prompt\": \"Output prompt\",\n\t\"image_numbers\": 1\n}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        120,
        400
      ],
      "id": "a56a8a19-4953-43b5-be93-b89da45ecd7b",
      "name": "Product Image Agent",
      "retryOnFail": false
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "create-image",
        "options": {}
      },
      "id": "afbc54b2-a6e0-43bc-930d-249c39379601",
      "name": "Webhook from Line Message",
      "type": "n8n-nodes-base.webhook",
      "position": [
        -580,
        400
      ],
      "webhookId": "83f6799b-f199-4e5c-9e8d-eab567733261",
      "typeVersion": 2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "b63773bb-f010-4018-8142-240c9aaa4570",
              "operator": {
                "name": "filter.operator.equals",
                "type": "string",
                "operation": "equals"
              },
              "leftValue": "={{$('Webhook from Line Message').item.json.body.events[0].type}}",
              "rightValue": "message"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "8ffefce7-d4ac-498e-bf22-051055044152",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "position": [
        -160,
        400
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "content": "## çµæ§‹åŒ–è¼¸å‡º\n\n",
        "height": 220,
        "width": 230,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        460,
        680
      ],
      "id": "42cde617-e973-48c5-9a59-85c36b2f2902",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "## ç”¢ç”Ÿåœ–ç‰‡ ï¼‹ å›å‚³ Line å€‹äººåŠ©ç†\n\n",
        "height": 420,
        "width": 1210
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        480,
        220
      ],
      "id": "c42720af-4716-4a20-a8c7-36de5ad9da25",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "content": "## LLM - GPT 4.1\n\n",
        "height": 220,
        "width": 210,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -220,
        680
      ],
      "id": "9600225a-8497-4f2c-ac11-2c4f452e6af5",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "## Line webhook + GPT Model\n\n- dall-e-2\n- dall-e-3\n- gpt-image-1\n\n",
        "height": 260,
        "width": 790
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -780,
        320
      ],
      "id": "7240ace9-0485-4751-82ea-a38af404dd8d",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "db9db45d-577b-42a3-b06e-e1a69c7f6974",
              "name": "model",
              "value": "gpt-image-1",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -360,
        400
      ],
      "id": "61b15a52-c336-4f1c-8cef-8c83e5ddaef7",
      "name": "Model"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data[0].b64_json",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        980,
        300
      ],
      "id": "a8f28f3b-e0b4-42d5-aacd-a77d8eb238d3",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "name": "=OpenAI-{{ $('Model').item.json.model }}-é›»å•†å•†å“ç¯„ä¾‹.png\n",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "https://drive.google.com/drive/folders/1-PXuV9fg4K6vAFcvbyxzG3Pf0U3_4zvC",
          "mode": "url"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1200,
        300
      ],
      "id": "95c3c816-25f3-4d14-828f-afeca6b81d99",
      "name": "Upload Image",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "FOJsxE5vAvlfyH16",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Model').item.json.model }}",
                    "rightValue": "gpt-image-1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "4c785677-787f-40e2-8612-6a248d8027a4"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "655e268b-137b-4e69-8fcd-a4354912ae4b",
                    "leftValue": "={{ $('Model').item.json.model }}",
                    "rightValue": "gpt-image-1",
                    "operator": {
                      "type": "string",
                      "operation": "notEquals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        520,
        400
      ],
      "id": "ad2e4cf8-4b46-4f16-a60c-a6ec642a422d",
      "name": "Switch"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/images/generations",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "openAiApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "={{ $('Model').item.json.model }}"
            },
            {
              "name": "prompt",
              "value": "={{ $json.output.prompt }}"
            },
            {
              "name": "n",
              "value": "={{ $json.output.image_numbers }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        760,
        300
      ],
      "id": "a38f6569-f448-46ca-9139-55657547d275",
      "name": "gpt-image-1",
      "credentials": {
        "googlePalmApi": {
          "id": "YTi08zt9SSPHxDEj",
          "name": "Google Gemini(PaLM) Api account"
        },
        "openAiApi": {
          "id": "vo1Kz0pllXw8z5Cv",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/images/generations",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "openAiApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "={{ $('Model').item.json.model }}"
            },
            {
              "name": "prompt",
              "value": "={{ $json.output.prompt }}"
            },
            {
              "name": "n",
              "value": "={{ $json.output.image_numbers }}"
            },
            {
              "name": "response_format",
              "value": "b64_json"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        760,
        480
      ],
      "id": "5ff2c17d-539e-4188-8e71-fe42eede054d",
      "name": "dall-e",
      "credentials": {
        "googlePalmApi": {
          "id": "YTi08zt9SSPHxDEj",
          "name": "Google Gemini(PaLM) Api account"
        },
        "openAiApi": {
          "id": "vo1Kz0pllXw8z5Cv",
          "name": "OpenAi account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "Product Image Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "Product Image Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI 4.1": {
      "ai_languageModel": [
        [
          {
            "node": "Product Image Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Product Image Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Product Image Agent": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook from Line Message": {
      "main": [
        [
          {
            "node": "Model",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Product Image Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Line : Reply Image": {
      "main": [
        []
      ]
    },
    "Model": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Upload Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload Image": {
      "main": [
        [
          {
            "node": "Line : Reply Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "gpt-image-1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "dall-e",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "gpt-image-1": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dall-e": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Taipei",
    "callerPolicy": "workflowsFromSameOwner",
    "executionTimeout": 900,
    "errorWorkflow": "0fS0IZwY5xyvbexo"
  },
  "versionId": "2e2731fa-fb10-437c-be8e-be8bdceab371",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "98fc6998a4fc974191a50fd1e28f3c93149311bffb0a029723a4889a4111c908"
  },
  "id": "DGJeEEeNdIOUDZxK",
  "tags": [
    {
      "createdAt": "2025-02-20T10:56:36.149Z",
      "updatedAt": "2025-02-20T10:56:36.149Z",
      "id": "qc8YQ51rp9Uf0sOf",
      "name": "prd"
    },
    {
      "createdAt": "2025-03-17T08:20:06.861Z",
      "updatedAt": "2025-03-17T08:20:06.861Z",
      "id": "pvRmfUcHdkTEgrk9",
      "name": "yt"
    }
  ]
}